@page "/editquest"
@using Clients
@using Models
@inject NavigationManager Navigator
@inject QuestsClient Quests

<PageTitle>New Quest</PageTitle>
<h3>New Quest</h3>

<div class="row">
  <div class="col-md-4">
    <EditForm FormName="EditQuest" Model="@quest" OnSubmit="HandleEdit">
      <div class="mb-3">
        <label for="name" class="form-label">Quest Name:</label>
        <InputText id="name" @bind-Value="quest.QuestName" class="form-control" />
      </div>
      <div class="mb-3">
        <label for="desc" class="form-label">Quest Description (optional):</label>
        <InputText id="desc" @bind-Value="quest.Description" class="form-control" />
      </div>
      @if(genres is null){
        <p><em>Loading...</em></p>
      }
      else{
        <div class="mb-3">
          <label for="genre" class="form-label">Quest Genre:</label>
          <InputSelect id="genre" @bind-Value="quest.QuestGenreId" class="form-select" >
            <option value="" >Select genre</option>
            @foreach(var genre in genres){
              <option value="@genre.Id">@genre.GenreName</option>
            }
          
          </InputSelect>
      </div>
      }
      <div class="mb-3">
        <label for="importance" class="form-label">Quest Importance:</label>
        <InputNumber id="importance" @bind-Value="quest.Importance" class="form-control" />
      </div>
      <div class="mb-3">
        <label for="starttime" class="form-label">Start Time:</label>
        <InputDate id="starttime" Type="InputDateType.Time" @bind-Value="@quest.StartTime" />
      </div>
      <button type="submit" class="btn btn-primary">Submit!</button>
      <a role="button" class="btn btn-secondary" href="/">Cancel</a>
      
    </EditForm>
  </div>
</div>

@code{ 
  //quest details to przechodnia struktura aby utworzyc quest summary z uzyciem genrow
  [SupplyParameterFromForm]
  private QuestDetails quest { get; set; } = new(){
    QuestName = string.Empty
  };

  private GenresClient genresClient = new();
  private Genre[]? genres;

  //dlaczego nie genres=new genresClient().GetGenres?
  protected override void OnInitialized(){
    genres = genresClient.GetGenres();
  } 
  private void HandleEdit(){
    Quests.AddQuest(quest);
    Navigator.NavigateTo("/");
  }
}    
